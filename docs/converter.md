<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/converter.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Converters

Converters are used to split a target into its component parts, then verify each of those parts.

When a target is split the result the result is:

 * The info file (containing the metadata of the target) serialized as json. File name: `{TestType}.{TestMethod}.info.verified.txt`
 * Zero or more documents of a specified extension. File name: `{TestType}.{TestMethod}.{Index}.verified.{Extension}`


## Usage scenarios

 * tiff => png per page
 * spreadsheet => csv per sheet
 * pdf => pdf per page


## Example

Both the following examples take an input tiff and convert it to:

The info file:

<!-- snippet: ConverterSnippets.Type.info.verified.txt -->
<a id='snippet-ConverterSnippets.Type.info.verified.txt'/></a>
```txt
{
  PixelFormat: 'Format8bppIndexed',
  Size: '473, 355'
}
```
<sup><a href='/src/Verify.Tests/Snippets/ConverterSnippets.Type.info.verified.txt#L1-L4' title='File snippet `ConverterSnippets.Type.info.verified.txt` was extracted from'>snippet source</a> | <a href='#snippet-ConverterSnippets.Type.info.verified.txt' title='Navigate to start of snippet `ConverterSnippets.Type.info.verified.txt`'>anchor</a></sup>
<!-- endsnippet -->

Multiple png files:

<img src="../Verify.Tests/Snippets/ConverterSnippets.Type.00.verified.png" alt="Converter page one verified" width="400">


### Typed converter

This sample uses a typed approach. So the converter acts on an in memory instance matching based on type

<!-- snippet: RegisterFileConverterType -->
<a id='snippet-registerfileconvertertype'/></a>
```cs
SharedVerifySettings.RegisterFileConverter<Image>(
    toExtension: "png",
    canConvert: target => Equals(target.RawFormat, ImageFormat.Tiff),
    conversion: (image, settings) =>
    {
        var pages = image.GetFrameCount(FrameDimension.Page);

        var streams = new List<Stream>();
        for (var index = 0; index < pages; index++)
        {
            image.SelectActiveFrame(FrameDimension.Page, index);

            var page = new MemoryStream();
            image.Save(page, ImageFormat.Png);
            streams.Add(page);
        }

        return new ConversionResult(
            info: new
            {
                image.PixelFormat,
                image.Size
            },
            streams);
    });
```
<sup><a href='/src/Verify.Tests/Snippets/ConverterSnippets.cs#L17-L46' title='File snippet `registerfileconvertertype` was extracted from'>snippet source</a> | <a href='#snippet-registerfileconvertertype' title='Navigate to start of snippet `registerfileconvertertype`'>anchor</a></sup>
<!-- endsnippet -->

<!-- snippet: FileConverterTypeVerify -->
<a id='snippet-fileconvertertypeverify'/></a>
```cs
using var stream = File.OpenRead("sample.tif");
await Verify(Image.FromStream(stream));
```
<sup><a href='/src/Verify.Tests/Snippets/ConverterSnippets.cs#L47-L50' title='File snippet `fileconvertertypeverify` was extracted from'>snippet source</a> | <a href='#snippet-fileconvertertypeverify' title='Navigate to start of snippet `fileconvertertypeverify`'>anchor</a></sup>
<!-- endsnippet -->

Note that this sample also uses the optional 

<!-- snippet: ConverterCanConvert -->
<a id='snippet-convertercanconvert'/></a>
```cs
canConvert: target => Equals(target.RawFormat, ImageFormat.Tiff),
```
<sup><a href='/src/Verify.Tests/Snippets/ConverterSnippets.cs#L20-L22' title='File snippet `convertercanconvert` was extracted from'>snippet source</a> | <a href='#snippet-convertercanconvert' title='Navigate to start of snippet `convertercanconvert`'>anchor</a></sup>
<!-- endsnippet -->

### Expression converter

<!-- snippet: RegisterFileConverterExtension -->
<a id='snippet-registerfileconverterextension'/></a>
```cs
SharedVerifySettings.RegisterFileConverter(
    fromExtension: "tif",
    toExtension: "png",
    conversion: (stream, settings) =>
    {
        using Image image = Image.FromStream(stream);
        var pages = image.GetFrameCount(FrameDimension.Page);

        var streams = new List<Stream>();
        for (var index = 0; index < pages; index++)
        {
            image.SelectActiveFrame(FrameDimension.Page, index);

            var page = new MemoryStream();
            image.Save(page, ImageFormat.Png);
            streams.Add(page);
        }

        return new ConversionResult(
            info: new
            {
                image.PixelFormat,
                image.Size
            },
            streams);
    });
```
<sup><a href='/src/Verify.Tests/Snippets/ConverterSnippets.cs#L56-L84' title='File snippet `registerfileconverterextension` was extracted from'>snippet source</a> | <a href='#snippet-registerfileconverterextension' title='Navigate to start of snippet `registerfileconverterextension`'>anchor</a></sup>
<!-- endsnippet -->

<!-- snippet: FileConverterExtensionVerify -->
<a id='snippet-fileconverterextensionverify'/></a>
```cs
await VerifyFile("sample.tif");
```
<sup><a href='/src/Verify.Tests/Snippets/ConverterSnippets.cs#L85-L87' title='File snippet `fileconverterextensionverify` was extracted from'>snippet source</a> | <a href='#snippet-fileconverterextensionverify' title='Navigate to start of snippet `fileconverterextensionverify`'>anchor</a></sup>
<!-- endsnippet -->
